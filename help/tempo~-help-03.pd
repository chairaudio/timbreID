#N canvas 394 154 952 764 10;
#X obj 4 5 cnv 10 400 10 empty empty empty 20 12 0 14 -233017 -66577
0;
#X obj 4 5 cnv 10 10 400 empty empty empty 20 12 0 14 -233017 -66577
0;
#X text 655 704 July 2017;
#X obj 54 99 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1 1
;
#X msg 358 605 fit_bounds;
#X floatatom 95 98 5 65 175 1 bpm - -, f 5;
#X floatatom 54 635 10 0 0 1 BPM-mode - -, f 10;
#X obj 358 575 table \$0-onsets-buffer;
#X obj 358 626 tabletool \$0-onsets-buffer;
#X obj 176 182 *~;
#X obj 176 203 dac~;
#X floatatom 217 179 5 0 0 0 - - -, f 5;
#X obj 217 199 dbtorms;
#N canvas 697 125 540 561 synth-beat 0;
#X obj 107 361 vline~;
#X obj 52 395 *~;
#X obj 151 147 metro 500;
#X obj 345 54 t b f;
#X obj 345 96 /;
#X floatatom 345 117 10 0 0 1 seconds - -, f 10;
#X obj 345 205 / 1024;
#X floatatom 345 226 10 0 0 1 frames - -, f 10;
#X floatatom 362 178 10 0 0 1 samples - -, f 10;
#X msg 345 75 60;
#X obj 345 137 * 44100;
#X obj 44 88 noise~;
#X obj 202 72 * 1000;
#X obj 272 408 *~;
#X obj 312 379 vline~;
#X obj 180 195 f;
#X obj 255 188 + 1;
#X obj 180 216 select 0;
#X floatatom 226 138 5 0 0 0 - - -, f 5;
#X obj 312 289 t b;
#X obj 312 310 random 100;
#X msg 107 340 0.5 2 \, 0 2 10;
#X obj 80 472 +~;
#X floatatom 251 25 5 0 0 0 - - -, f 5;
#X obj 251 45 t b f;
#X obj 107 291 random 100;
#X obj 107 312 moses 90;
#X obj 202 112 / 4;
#X obj 255 209 % 4;
#X obj 345 14 inlet;
#X obj 90 18 inlet;
#X obj 80 493 outlet~;
#X floatatom 218 278 5 0 0 0 - - -, f 5;
#X floatatom 433 284 5 0 0 0 - - -, f 5;
#X msg 312 358 0.35 2 \, 0 2 10;
#X obj 312 331 moses 35;
#X connect 0 0 1 1;
#X connect 1 0 22 0;
#X connect 2 0 15 0;
#X connect 3 0 9 0;
#X connect 3 1 4 1;
#X connect 4 0 5 0;
#X connect 4 0 12 0;
#X connect 5 0 10 0;
#X connect 6 0 7 0;
#X connect 9 0 4 0;
#X connect 10 0 6 0;
#X connect 10 0 8 0;
#X connect 11 0 1 0;
#X connect 11 0 13 0;
#X connect 12 0 27 0;
#X connect 13 0 22 1;
#X connect 14 0 13 1;
#X connect 15 0 16 0;
#X connect 15 0 17 0;
#X connect 16 0 28 0;
#X connect 17 0 25 0;
#X connect 17 1 19 0;
#X connect 19 0 20 0;
#X connect 20 0 35 0;
#X connect 21 0 0 0;
#X connect 22 0 31 0;
#X connect 23 0 24 0;
#X connect 24 0 27 0;
#X connect 24 1 27 1;
#X connect 24 1 28 1;
#X connect 25 0 26 0;
#X connect 26 0 21 0;
#X connect 27 0 2 1;
#X connect 27 0 18 0;
#X connect 28 0 15 1;
#X connect 29 0 3 0;
#X connect 30 0 2 0;
#X connect 32 0 26 1;
#X connect 33 0 35 1;
#X connect 34 0 14 0;
#X connect 35 0 34 0;
#X restore 54 121 pd synth-beat;
#N canvas 95 523 450 300 drum-loop-file 0;
#X obj 65 171 readsf~;
#X msg 111 135 stop;
#X obj 65 20 inlet;
#X obj 65 192 outlet~;
#X msg 65 84 open /Users/williambrent/Dropbox/PUREDATA/patches/research/specGrowth/drumloop1.wav
\, start;
#X connect 0 0 3 0;
#X connect 0 1 4 0;
#X connect 1 0 0 0;
#X connect 2 0 4 0;
#X connect 4 0 0 0;
#X restore 176 122 pd drum-loop-file;
#X obj 176 92 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X obj 582 544 t b b;
#X obj 582 565 timer;
#X obj 582 586 t b f;
#X msg 582 607 60000;
#X obj 582 628 /;
#X floatatom 582 649 10 0 0 0 - - -, f 10;
#X obj 582 504 key;
#X obj 582 525 select 32;
#X floatatom 134 555 10 0 0 1 BPM-raw - -, f 10;
#N canvas 663 23 778 503 general-settings 0;
#X obj 215 256 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 95 124 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X msg 95 144 power_spectrum \$1;
#X obj 33 437 outlet;
#X obj 33 58 hradio 15 1 0 5 empty empty empty 0 -8 0 10 -262144 -1
-1 1;
#X msg 33 78 window_function \$1;
#X msg 215 274 squared_diff \$1;
#X msg 275 334 overlap 2;
#X text 366 321 Inside a subpatch with re-blocking involving overlap
(e.g. \, [block~ 4096 2]) \, you'll need to change the overlap for
things to behave properly;
#X text 31 21 Change windowing function. Rectangular (0) \, Blackman
(1) \, Cosine (2) \, Hamming (3) \, or Hann (4). (default: Blackman)
;
#X text 223 184 Change window size;
#X text 126 104 Use power instead of magnitude spectrum for the spectral
growth analysis stage;
#X text 243 224 Change analysis hop and frame separation;
#X msg 135 184 window 2048;
#X msg 175 224 hop 256;
#X text 327 263 Use squared spectral difference vs. absolute value
of spectral difference for onset data;
#X connect 0 0 6 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 4 0 5 0;
#X connect 5 0 3 0;
#X connect 6 0 3 0;
#X connect 7 0 3 0;
#X connect 13 0 3 0;
#X connect 14 0 3 0;
#X restore 194 332 pd general-settings;
#N canvas 593 47 921 726 tempo-algorithm-settings 0;
#X obj 33 606 outlet;
#X floatatom 153 204 5 0 0 1 % - -, f 5;
#X msg 153 224 thresh \$1;
#X floatatom 33 63 10 0 0 0 - - -, f 10;
#X msg 33 84 onset_buf_duration \$1;
#X msg 273 344 freq_range 125 1000;
#X obj 213 304 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X msg 233 304 max_onset_peak_update \$1;
#X text 438 453 These settings are good for the drum loop audio file
and synth drum beat included with this help file.;
#X obj 370 466 loadbang;
#X msg 73 124 tempo_range 90 170;
#X msg 193 264 reset_max_onset_peak;
#X text 122 61 Onset buffer size (ms);
#X text 212 123 Tempo range to search for (BPM);
#X text 222 173 Number of harmonics to search for in HPS algorithm
;
#X text 359 263 Reset the current maximum peak value and search for
a new one, f 63;
#X text 420 303 Enable/disable updating of the maximum onset peak value
(default: ON), f 72;
#X msg 113 174 harmonics 4;
#X text 244 206 Onset peak threshold as percentage of the current maximum
peak value (default: 20%), f 46;
#X text 434 337 specify a limited frequency band in Hz to use in spectral
differencing onset algorithm (default: 0Hz to Nyquist);
#X msg 313 384 below_thresh_default 0.01;
#X text 494 378 specify a value for all onset data to be bashed to
if it falls below the current thresh (default: 1.0);
#X msg 370 490 tempo_buffer_size 50 \, tempo_range 60 170 \, freq_range
30 1000 \, thresh 25 \, harmonics 6;
#X connect 1 0 2 0;
#X connect 2 0 0 0;
#X connect 3 0 4 0;
#X connect 4 0 0 0;
#X connect 5 0 0 0;
#X connect 6 0 7 0;
#X connect 7 0 0 0;
#X connect 10 0 0 0;
#X connect 11 0 0 0;
#X connect 17 0 0 0;
#X connect 20 0 0 0;
#X connect 22 0 0 0;
#X restore 214 352 pd tempo-algorithm-settings;
#N canvas 49 508 450 300 plot-onsets-data 0;
#X obj 84 51 inlet;
#X obj 84 150 list prepend 0;
#X obj 84 90 t l l;
#X obj 205 149 change;
#X obj 205 171 pack f \$0;
#X obj 205 129 list length;
#X msg 205 193 \; \$2-onsets-buffer resize \$1 \;;
#X obj 84 171 s \$0-onsets-buffer;
#X connect 0 0 2 0;
#X connect 1 0 7 0;
#X connect 2 0 1 0;
#X connect 2 1 5 0;
#X connect 3 0 4 0;
#X connect 4 0 6 0;
#X connect 5 0 3 0;
#X restore 174 525 pd plot-onsets-data;
#X text 652 563 A manual tap-tempo measurement for reference to compare
against [tempo~] output, f 31;
#X floatatom 94 585 10 0 0 1 confidence-% - -, f 10;
#X obj 160 239 adc~;
#X obj 160 260 *~;
#X obj 190 260 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 54 657 change;
#X obj 34 657 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X obj 54 441 tempo~ 1024 128;
#X obj 54 678 spigot;
#X obj 54 699 print TEMPO;
#X obj 99 678 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X text 655 684 Updated for timbreID version 0.7.6;
#X text 436 54 [tempo~] estimates the tempo in BPM of an input signal.
Its analysis process involves three main stages: spectral growth analysis
of the input to harvest sound onset peaks \, a Harmonic Product Spectrum
(HPS) algorithm that analyzes the onset peak data \, and finally a
mode analysis of the most recent tempo estimate results in order to
provide a more steady result.;
#X msg 109 50 90;
#X obj 109 29 loadbang;
#X text 437 354 While you can use the raw tempo results appearing at
the 3rd outlet \, a safer bet is the tempo reported at the 1st outlet.
This tempo is the mode of the most recent N raw tempo results rounded
to the nearest BPM. The confidence rating given at the 2nd outlet is
simply the number of appearances of the mode scaled according to the
tempo buffer size N in order to be given in percent. Thus \, if you
set the tempo buffer size to N=100 \, the confidence rating is directly
the number of occurrences of the tempo mode. Tempo mode adds yet more
latency \, as the tempo buffer is filled gradually as new raw tempo
results appear.;
#X text 437 154 There are many settings that affect the accuracy and
latency of results reported by [tempo~] \, and some familiarity with
spectral growth analysis and the HPS algorithm will be helpful. Prior
knowledge about the signal you're analyzing is very helpful as well.
For instance \, if you're expecting tempi somewhere in the range of
90-120 BPM \, you can let [tempo~] know this via the "tempo_range"
message \, and reduce the possibility of half or double tempo errors
(which are common with this technique). If you know your signal contains
a steady kick drum beat \, you can use the "freq_range" message to
limit the frequency range to 30-500Hz or so \, and only look for onsets
there. Depending on your needs \, high latency might be acceptable
\, which can also improve results. Control this with the "onset_buf_duration"
message. See inside [pd tempo-algorithm-settings] for more information
on these and other important settings.;
#N canvas 949 426 673 487 more-settings 0;
#X obj 33 416 outlet;
#X floatatom 33 63 5 0 0 0 - - -, f 5;
#X msg 33 84 tempo_buffer_const \$1;
#X text 122 61 Fill the tempo buffer with a particular BPM value;
#X msg 73 124 tempo_buffer_clear;
#X text 212 123 Initialize the tempo buffer \, filling it with -1's
;
#X text 294 158 size of the buffer holding the latest tempo measurements.
the mode of this buffer is the tempo sent out outlet 1;
#X msg 113 164 tempo_buffer_size 50;
#X msg 193 244 print;
#X obj 133 204 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X msg 153 204 debug \$1;
#X text 274 242 print internal settings and info to the Pd console
;
#X text 254 203 activate debug mode;
#X connect 1 0 2 0;
#X connect 2 0 0 0;
#X connect 4 0 0 0;
#X connect 7 0 0 0;
#X connect 8 0 0 0;
#X connect 9 0 10 0;
#X connect 10 0 0 0;
#X restore 234 372 pd more-settings;
#X text 183 434 Creation arguments are window size and analysis hop
in samples, f 37;
#X text 74 59 these could be GOP with loadbang;
#X connect 3 0 13 0;
#X connect 4 0 8 0;
#X connect 5 0 13 1;
#X connect 6 0 33 0;
#X connect 9 0 10 0;
#X connect 9 0 10 1;
#X connect 11 0 12 0;
#X connect 12 0 9 1;
#X connect 13 0 9 0;
#X connect 13 0 35 0;
#X connect 14 0 9 0;
#X connect 14 0 35 0;
#X connect 15 0 14 0;
#X connect 16 0 17 0;
#X connect 16 1 17 1;
#X connect 17 0 18 0;
#X connect 18 0 19 0;
#X connect 18 1 20 1;
#X connect 19 0 20 0;
#X connect 20 0 21 0;
#X connect 22 0 23 0;
#X connect 23 0 16 0;
#X connect 25 0 35 0;
#X connect 26 0 35 0;
#X connect 30 0 31 0;
#X connect 31 0 35 0;
#X connect 32 0 31 1;
#X connect 33 0 34 0;
#X connect 33 0 36 0;
#X connect 35 0 6 0;
#X connect 35 1 29 0;
#X connect 35 2 24 0;
#X connect 35 3 27 0;
#X connect 36 0 37 0;
#X connect 38 0 36 1;
#X connect 41 0 5 0;
#X connect 42 0 41 0;
#X connect 45 0 35 0;
