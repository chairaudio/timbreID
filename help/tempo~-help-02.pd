#N canvas 475 175 920 721 10;
#X obj 4 5 cnv 10 400 10 empty empty empty 20 12 0 14 -233017 -66577
0;
#X obj 4 5 cnv 10 10 400 empty empty empty 20 12 0 14 -233017 -66577
0;
#N canvas 664 23 1016 696 other-settings 1;
#X text 191 249 Change window size.;
#X obj 300 368 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X text 338 367 Squared difference vs. Absolute value of difference.
;
#X obj 95 123 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X msg 95 143 power_spectrum \$1;
#X text 126 123 Use power instead of magnitude;
#X obj 33 606 outlet;
#X obj 33 57 hradio 15 1 0 5 empty empty empty 0 -8 0 10 -262144 -1
-1 1;
#X msg 33 77 window_function \$1;
#X msg 300 386 squared_diff \$1;
#X msg 358 435 overlap 2;
#X text 439 423 Inside a subpatch with re-blocking involving overlap
(e.g. \, [block~ 4096 2]) \, you'll need to change the overlap for
things to behave properly;
#X msg 193 270 window 2000;
#X text 31 20 Change windowing function. Rectangular (0) \, Blackman
(1) \, Cosine (2) \, Hamming (3) \, or Hann (4). (default: Blackman)
;
#X msg 401 497 print;
#X text 355 322 Change distance between analysis windows in samples
(must be multiple of block size) \;;
#X floatatom 505 210 5 1 10 0 - - -, f 5;
#X obj 505 230 t b f;
#X msg 505 251 64;
#X obj 505 272 *;
#X floatatom 505 293 5 0 0 0 - - -, f 5;
#X msg 245 323 hop \$1;
#X floatatom 280 629 10 0 0 1 % - -, f 10;
#X msg 280 649 thresh \$1;
#X floatatom 496 480 10 0 0 0 - - -, f 10;
#X obj 511 514 pack f f;
#X obj 511 535 list prepend freq_range;
#X obj 511 556 list trim;
#X floatatom 592 471 10 0 0 0 - - -, f 10;
#X obj 592 491 t b f;
#X floatatom 139 186 5 0 0 0 - - -, f 5;
#X msg 139 206 below_thresh_default \$1;
#X obj 467 140 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X msg 467 160 align_first_peak \$1;
#X floatatom 419 64 5 0 0 0 - - -, f 5;
#X floatatom 638 209 5 0 0 0 - - -, f 5;
#X msg 638 229 harmonics \$1;
#X text 470 50 onset buffer size in ms;
#X msg 610 595 harmonics \$1 \, tempo_range 90 160 \, onset_buf_duration
5000;
#X floatatom 708 561 5 0 0 0 - - -, f 5;
#X msg 419 85 onset_buf_duration \$1;
#X obj 419 32 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X msg 257 560 reset_max_onset_peak_val;
#X obj 668 53 loadbang;
#X msg 824 379 60;
#X obj 824 400 / 180;
#X obj 824 421 * 44100;
#X obj 824 442 / 128;
#X obj 824 484 i;
#X obj 824 463 + 0.5;
#X floatatom 824 505 5 0 0 0 - - -, f 5;
#X msg 668 274 tempo_range 350 360;
#X floatatom 855 313 5 0 0 0 - - -, f 5;
#X obj 855 333 t b f;
#X text 868 286 tempo to idx;
#X msg 635 96 harmonics 5 \, tempo_range 90 180 \, freq_range 22 750
\, onset_buf_duration 5000 \, thresh 25 \, below_thresh_default 0 \,
align_first_peak 1 \,;
#X text 759 59 This works for drum loop 2 = 94BPM!;
#X text 759 79 Also works for drum loop 1 = 160BPM!;
#X connect 1 0 9 0;
#X connect 3 0 4 0;
#X connect 4 0 6 0;
#X connect 7 0 8 0;
#X connect 8 0 6 0;
#X connect 9 0 6 0;
#X connect 10 0 6 0;
#X connect 12 0 6 0;
#X connect 14 0 6 0;
#X connect 16 0 17 0;
#X connect 17 0 18 0;
#X connect 17 1 19 1;
#X connect 18 0 19 0;
#X connect 19 0 20 0;
#X connect 20 0 21 0;
#X connect 21 0 6 0;
#X connect 22 0 23 0;
#X connect 23 0 6 0;
#X connect 24 0 25 0;
#X connect 25 0 26 0;
#X connect 26 0 27 0;
#X connect 27 0 6 0;
#X connect 28 0 29 0;
#X connect 29 0 25 0;
#X connect 29 1 25 1;
#X connect 30 0 31 0;
#X connect 31 0 6 0;
#X connect 32 0 33 0;
#X connect 33 0 6 0;
#X connect 34 0 40 0;
#X connect 35 0 36 0;
#X connect 36 0 6 0;
#X connect 38 0 6 0;
#X connect 39 0 38 0;
#X connect 40 0 6 0;
#X connect 41 0 34 0;
#X connect 42 0 6 0;
#X connect 43 0 55 0;
#X connect 44 0 45 0;
#X connect 45 0 46 0;
#X connect 46 0 47 0;
#X connect 47 0 49 0;
#X connect 48 0 50 0;
#X connect 49 0 48 0;
#X connect 51 0 6 0;
#X connect 52 0 53 0;
#X connect 53 0 44 0;
#X connect 53 1 45 1;
#X connect 55 0 6 0;
#X restore 374 203 pd other-settings;
#X text 599 448 Updated for timbreID version 0.7;
#X text 599 468 July 2017;
#N canvas 49 508 450 300 do-plotting 0;
#X obj 84 51 inlet;
#X obj 84 150 list prepend 0;
#X obj 84 90 t l l;
#X obj 205 149 change;
#X obj 205 171 pack f \$0;
#X obj 205 129 list length;
#X msg 205 193 \; \$2-onsets-buffer resize \$1 \;;
#X obj 84 171 s \$0-onsets-buffer;
#X floatatom 325 123 5 0 0 0 - - -, f 5;
#X connect 0 0 2 0;
#X connect 1 0 7 0;
#X connect 2 0 1 0;
#X connect 2 1 5 0;
#X connect 3 0 4 0;
#X connect 4 0 6 0;
#X connect 5 0 3 0;
#X connect 5 0 8 0;
#X restore 208 364 pd do-plotting;
#X obj 54 99 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0 1
;
#X text 201 300 Creation arguments are window size and hop in samples
between analysis windows., f 48;
#X msg 681 51 fit_bounds;
#X floatatom 95 98 5 0 0 1 bpm - -, f 5;
#X floatatom 90 339 10 0 0 1 BPM - -, f 10;
#X obj 444 95 table \$0-onsets-buffer;
#X obj 681 72 tabletool \$0-onsets-buffer;
#X obj 71 383 t f b;
#X obj 69 630 tabwrite tempo;
#X obj 189 625 f;
#X obj 229 621 + 1;
#X msg 196 428 mode;
#X obj 196 457 tabletool tempo;
#X floatatom 196 486 10 0 0 1 BPM-best-guess - -, f 10;
#X floatatom 309 458 5 0 0 1 num-occ - -, f 5;
#X obj 178 193 *~;
#X obj 178 214 dac~;
#X floatatom 219 190 5 0 0 0 - - -, f 5;
#X obj 219 210 dbtorms;
#X obj 196 536 i;
#X msg 196 569 \; tempo ylabel -50 \$1;
#X floatatom 235 530 5 0 0 0 - - -, f 5;
#N canvas 357 473 540 561 synth-beat 0;
#X obj 107 361 vline~;
#X obj 52 395 *~;
#X obj 151 147 metro 500;
#X obj 345 54 t b f;
#X obj 345 96 /;
#X floatatom 345 117 10 0 0 1 seconds - -, f 10;
#X obj 345 205 / 1024;
#X floatatom 345 226 10 0 0 1 frames - -, f 10;
#X floatatom 362 178 10 0 0 1 samples - -, f 10;
#X msg 345 75 60;
#X obj 345 137 * 44100;
#X obj 44 88 noise~;
#X obj 202 72 * 1000;
#X obj 272 408 *~;
#X obj 312 379 vline~;
#X obj 180 195 f;
#X obj 255 188 + 1;
#X obj 180 216 select 0;
#X floatatom 226 138 5 0 0 0 - - -, f 5;
#X obj 312 289 t b;
#X obj 312 310 random 100;
#X obj 312 331 moses 50;
#X msg 107 340 0.5 2 \, 0 2 10;
#X obj 80 472 +~;
#X floatatom 251 25 5 0 0 0 - - -, f 5;
#X obj 251 45 t b f;
#X msg 312 358 0.2 2 \, 0 2 10;
#X obj 107 291 random 100;
#X obj 107 312 moses 90;
#X obj 202 112 / 4;
#X obj 255 209 % 4;
#X obj 345 14 inlet;
#X obj 90 18 inlet;
#X obj 80 493 outlet~;
#X floatatom 218 278 5 0 0 0 - - -, f 5;
#X floatatom 433 284 5 0 0 0 - - -, f 5;
#X connect 0 0 1 1;
#X connect 1 0 23 0;
#X connect 2 0 15 0;
#X connect 3 0 9 0;
#X connect 3 1 4 1;
#X connect 4 0 5 0;
#X connect 4 0 12 0;
#X connect 5 0 10 0;
#X connect 6 0 7 0;
#X connect 9 0 4 0;
#X connect 10 0 6 0;
#X connect 10 0 8 0;
#X connect 11 0 1 0;
#X connect 11 0 13 0;
#X connect 12 0 29 0;
#X connect 13 0 23 1;
#X connect 14 0 13 1;
#X connect 15 0 16 0;
#X connect 15 0 17 0;
#X connect 16 0 30 0;
#X connect 17 0 27 0;
#X connect 17 1 19 0;
#X connect 19 0 20 0;
#X connect 20 0 21 0;
#X connect 21 0 26 0;
#X connect 22 0 0 0;
#X connect 23 0 33 0;
#X connect 24 0 25 0;
#X connect 25 0 29 0;
#X connect 25 1 29 1;
#X connect 25 1 30 1;
#X connect 26 0 14 0;
#X connect 27 0 28 0;
#X connect 28 0 22 0;
#X connect 29 0 2 1;
#X connect 29 0 18 0;
#X connect 30 0 15 1;
#X connect 31 0 3 0;
#X connect 32 0 2 0;
#X connect 34 0 28 1;
#X connect 35 0 21 1;
#X restore 54 121 pd synth-beat;
#N canvas 0 23 450 300 drum-loop-file 0;
#X obj 65 171 readsf~;
#X msg 111 135 stop;
#X obj 74 20 inlet;
#X obj 65 192 outlet~;
#X msg 65 84 open /Users/williambrent/Dropbox/PUREDATA/patches/research/specGrowth/drumLoop1.wav
\, start;
#X connect 0 0 3 0;
#X connect 0 1 4 0;
#X connect 1 0 0 0;
#X connect 2 0 4 0;
#X connect 4 0 0 0;
#X restore 176 122 pd drum-loop-file;
#X obj 179 95 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X obj 669 96 tabletool tempo;
#X obj 365 538 change;
#X obj 365 559 print;
#X obj 450 390 t b b;
#X obj 450 411 timer;
#X obj 450 432 t b f;
#X msg 450 453 60000;
#X obj 450 474 /;
#X floatatom 450 495 10 0 0 0 - - -, f 10;
#X obj 450 350 key;
#X obj 450 371 select 32;
#X text 467 550 Should incorporate the buffer of tempo estimates and
mode analysis for final output. Could offer a third inlet that spits
out per-frame tempo estimates for processing differently if desired
;
#X text 467 620 How big shoud that tempo estimate buffer be? TWice
the onset buffer size? The mode function seems to be horrible computationally
expensive. Better look fro a better impementation than mine in [tabletool]
;
#X obj 196 506 + 0.5;
#X obj 673 195 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 673 215 switch~;
#X obj 587 167 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 587 187 metro 100;
#X obj 729 183 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 444 135 table yValues;
#N canvas 831 48 766 714 do-plotting 1;
#X obj 84 51 inlet;
#X obj 84 150 list prepend 0;
#X obj 205 149 change;
#X obj 205 129 list length;
#X msg 205 193 \; yValues resize \$1 \;;
#X obj 84 171 s yValues;
#X obj 84 90 t b l l;
#X msg 42 203 max;
#X obj 42 224 tabletool yValues;
#X floatatom 147 258 5 0 0 0 - - -, f 5;
#X floatatom 37 302 10 0 0 0 - - -, f 10;
#X msg 238 232 60;
#X obj 238 274 * 44100;
#X obj 238 337 i;
#X obj 238 316 + 0.5;
#X floatatom 238 358 5 0 0 0 - - -, f 5;
#X obj 177 397 +;
#X floatatom 177 418 5 0 0 0 - - -, f 5;
#X floatatom 485 288 5 0 0 0 - - -, f 5;
#X obj 485 308 pack f \$0;
#X msg 485 329 \; \$2-onsets-buffer xlabel 0 \$1 \;;
#X obj 546 140 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 546 160 f;
#X obj 585 154 + 1;
#X obj 546 181 + 1;
#X obj 526 223 *;
#X obj 585 175 % 6;
#X obj 324 142 loadbang;
#X obj 485 29 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 485 49 metro 250;
#X floatatom 347 375 5 0 0 0 - - -, f 5;
#X obj 347 395 pack f \$0;
#X msg 347 416 \; \$2-onsets-buffer ylabel 0 \$1 \;;
#X floatatom 292 15 5 0 0 0 - - -, f 5;
#X obj 292 35 tabwrite \$0-onsets-buffer;
#X floatatom 395 5 5 0 0 0 - - -, f 5;
#X obj 238 295 / 128;
#X floatatom 203 558 5 0 0 0 - - -, f 5;
#X obj 238 253 / 180;
#X floatatom 253 537 5 0 0 0 - - -, f 5;
#X obj 253 557 t b f;
#X obj 203 578 pack f f f \$0;
#X floatatom 384 505 5 0 0 0 - - -, f 5;
#X obj 317 86 tabread \$0-onsets-buffer;
#X floatatom 317 107 5 0 0 0 - - -, f 5;
#X msg 203 599 \; \$4-onsets-buffer bounds \$1 \$3 \$2 0 \; yValues
bounds \$1 600 \$2 0 \;;
#X obj 384 525 t b f;
#X connect 0 0 6 0;
#X connect 1 0 5 0;
#X connect 2 0 4 0;
#X connect 3 0 2 0;
#X connect 6 0 7 0;
#X connect 6 1 1 0;
#X connect 6 2 3 0;
#X connect 7 0 8 0;
#X connect 8 0 10 0;
#X connect 8 1 9 0;
#X connect 9 0 25 1;
#X connect 11 0 38 0;
#X connect 12 0 36 0;
#X connect 13 0 15 0;
#X connect 13 0 16 1;
#X connect 14 0 13 0;
#X connect 16 0 17 0;
#X connect 18 0 19 0;
#X connect 19 0 20 0;
#X connect 21 0 22 0;
#X connect 22 0 23 0;
#X connect 22 0 24 0;
#X connect 23 0 26 0;
#X connect 24 0 25 0;
#X connect 25 0 18 0;
#X connect 25 0 35 0;
#X connect 26 0 22 1;
#X connect 27 0 11 0;
#X connect 28 0 29 0;
#X connect 29 0 22 0;
#X connect 30 0 31 0;
#X connect 31 0 32 0;
#X connect 33 0 34 0;
#X connect 35 0 34 1;
#X connect 35 0 43 0;
#X connect 36 0 14 0;
#X connect 37 0 41 0;
#X connect 38 0 12 0;
#X connect 39 0 40 0;
#X connect 40 0 41 0;
#X connect 40 1 41 1;
#X connect 41 0 45 0;
#X connect 42 0 46 0;
#X connect 43 0 44 0;
#X connect 46 0 41 0;
#X connect 46 1 41 2;
#X restore 255 336 pd do-plotting;
#X obj 679 120 tabletool yValues;
#X text 545 330 Instead of percent peak method (for which the max peak
in the onsetsBuffer is re-evaluated each frame and will therefore fluctuate
wildly) \, we're probably better off doing what was done in Octave
\, which is to get the mean and std of the onsetsBuffer and use that
as a fixed thresh. This mean/std could be snapshotted at a desired
time once \, and reset as desired;
#X floatatom 617 150 5 0 0 0 - - -, f 5;
#X obj 341 553 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 586 217 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 598 97 select 115;
#X msg 289 256 reset_max_onset_peak_val;
#X msg 142 249 print;
#X obj 69 303 tempo~ 1024 128;
#X obj 31 425 t b b;
#X obj 31 446 timer;
#X floatatom 31 467 15 0 0 0 - - -, f 15;
#X obj 229 641 % 50;
#X obj 444 115 table tempo 50;
#X connect 2 0 60 0;
#X connect 6 0 28 0;
#X connect 8 0 12 0;
#X connect 8 0 31 0;
#X connect 8 0 52 0;
#X connect 9 0 28 1;
#X connect 13 0 14 0;
#X connect 13 1 15 0;
#X connect 13 1 17 0;
#X connect 15 0 16 0;
#X connect 15 0 14 1;
#X connect 16 0 64 0;
#X connect 17 0 18 0;
#X connect 18 0 19 0;
#X connect 18 1 20 0;
#X connect 19 0 44 0;
#X connect 21 0 22 0;
#X connect 21 0 22 1;
#X connect 23 0 24 0;
#X connect 24 0 21 1;
#X connect 25 0 26 0;
#X connect 25 0 27 0;
#X connect 25 0 32 0;
#X connect 28 0 21 0;
#X connect 28 0 60 0;
#X connect 29 0 21 0;
#X connect 29 0 60 0;
#X connect 30 0 29 0;
#X connect 32 0 33 0;
#X connect 32 0 55 0;
#X connect 34 0 35 0;
#X connect 34 1 35 1;
#X connect 35 0 36 0;
#X connect 36 0 37 0;
#X connect 36 1 38 1;
#X connect 37 0 38 0;
#X connect 38 0 39 0;
#X connect 40 0 41 0;
#X connect 41 0 34 0;
#X connect 44 0 25 0;
#X connect 45 0 46 0;
#X connect 47 0 48 0;
#X connect 48 0 46 0;
#X connect 48 0 56 0;
#X connect 49 0 46 0;
#X connect 54 0 48 1;
#X connect 57 0 47 0;
#X connect 58 0 60 0;
#X connect 59 0 60 0;
#X connect 60 0 10 0;
#X connect 60 0 13 0;
#X connect 60 0 61 0;
#X connect 60 1 5 0;
#X connect 60 2 51 0;
#X connect 61 0 62 0;
#X connect 61 1 62 1;
#X connect 62 0 63 0;
#X connect 64 0 15 1;
