#N canvas 317 159 745 594 10;
#X declare -path ../lib;
#N canvas 59 149 469 327 sample-loading 0;
#X obj 62 136 soundfiler;
#X obj 100 188 s sample-length;
#X obj 62 158 t b f;
#X msg 62 226 \; audio-file normalize 0.9 \;;
#X obj 266 199 table audio-file;
#X obj 62 54 r lb2;
#N canvas 354 207 572 349 resize-graphs 0;
#X obj 72 176 i;
#X obj 72 45 r sample-length;
#X obj 72 133 /;
#X obj 104 75 r hop;
#X obj 104 97 t b f;
#X msg 72 228 \; crossings-num-frames \$1 \; crossing-graph resize
\$1 \; crossing-graph bounds 0 500 \$1 0 \;;
#X obj 72 155 + 0.5;
#X text 151 152 Make crossing-graph array bigger than it needs to be
based on sample length and hop. We'll resize later in the analysis
subpatch;
#X connect 0 0 5 0;
#X connect 1 0 2 0;
#X connect 2 0 6 0;
#X connect 3 0 4 0;
#X connect 4 0 2 0;
#X connect 4 1 2 1;
#X connect 6 0 0 0;
#X restore 266 219 pd resize-graphs;
#X msg 62 100 read -resize ../audio/black-friday.wav audio-file;
#X connect 0 0 2 0;
#X connect 2 0 3 0;
#X connect 2 1 1 0;
#X connect 5 0 7 0;
#X connect 7 0 0 0;
#X restore 58 83 pd sample-loading;
#N canvas 242 22 847 791 analysis 0;
#X obj 276 272 f;
#X msg 297 232 0;
#X msg 276 547 analyze \$1 \$2;
#X obj 276 518 pack f f;
#X obj 312 272 + 1;
#X obj 276 381 *;
#X obj 276 294 t f f;
#X obj 276 403 t f f;
#X obj 276 489 spigot;
#X obj 309 429 +;
#X obj 309 461 <;
#X obj 276 196 until;
#X obj 471 367 select 0;
#X obj 339 461 r sample-length;
#X obj 291 347 r hop;
#X obj 351 518 r window-size;
#X obj 324 403 r window-size;
#X text 479 398 Stop if we go past the end fo the file;
#X obj 276 578 zeroCrossing audio-file;
#X obj 276 636 tabwrite crossing-graph;
#X obj 35 101 t b b b;
#X msg 47 548 max;
#X obj 74 583 tabletool crossing-graph;
#X obj 200 629 t l;
#X obj 35 506 t b b b b;
#X msg 86 547 size;
#X obj 35 667 list;
#X obj 107 625 list prepend;
#N canvas 0 22 550 559 find-peaks 0;
#X obj 123 170 tabletool crossing-graph;
#X obj 281 200 list prepend;
#X obj 376 201 t l;
#X obj 101 110 t b a b;
#X obj 101 261 list;
#X obj 101 283 t l l;
#X obj 101 414 list prepend 0;
#X obj 101 436 s peak-table;
#X obj 213 342 list length;
#X obj 295 364 r crossings-num-frames;
#X obj 213 364 pack f f;
#X msg 213 414 \; peak-table resize \$1 \; peak-table bounds 0 \$2
\$1 0 \;;
#X obj 295 73 table peak-table;
#X obj 101 58 inlet;
#X msg 101 88 peaks \$1;
#X connect 0 1 1 0;
#X connect 1 0 2 0;
#X connect 1 0 4 1;
#X connect 2 0 1 1;
#X connect 3 0 4 0;
#X connect 3 1 0 0;
#X connect 3 2 1 1;
#X connect 4 0 5 0;
#X connect 5 0 6 0;
#X connect 5 1 8 0;
#X connect 6 0 7 0;
#X connect 8 0 10 0;
#X connect 9 0 10 1;
#X connect 10 0 11 0;
#X connect 13 0 14 0;
#X connect 14 0 3 0;
#X restore 511 273 pd find-peaks;
#X obj 382 98 unpack f f;
#X obj 382 132 /;
#X obj 475 122 s overlap;
#X obj 382 157 s hop;
#X obj 443 148 s window-size;
#X msg 382 55 4096 4;
#X obj 382 24 r lb1;
#X obj 35 46 r lb3;
#X floatatom 511 251 5 0 100 0 - - -, f 5;
#X text 260 716 Resize and rebound based on actual number of frames
;
#X text 443 56 << change window size and overlap here if you want \,
then reload the patch.;
#X msg 35 703 \; crossing-graph resize \$1 \; crossing-graph bounds
0 \$2 \$1 0 \; crossing-preview bounds 0 \$2 49 0 \;;
#X connect 0 0 4 0;
#X connect 0 0 6 0;
#X connect 1 0 0 1;
#X connect 2 0 18 0;
#X connect 3 0 2 0;
#X connect 4 0 0 1;
#X connect 5 0 7 0;
#X connect 6 0 5 0;
#X connect 6 1 19 1;
#X connect 7 0 8 0;
#X connect 7 1 9 0;
#X connect 8 0 3 0;
#X connect 9 0 10 0;
#X connect 10 0 8 1;
#X connect 10 0 12 0;
#X connect 11 0 0 0;
#X connect 12 0 11 1;
#X connect 13 0 10 1;
#X connect 14 0 5 1;
#X connect 15 0 3 1;
#X connect 16 0 9 1;
#X connect 18 0 19 0;
#X connect 20 0 24 0;
#X connect 20 1 11 0;
#X connect 20 2 1 0;
#X connect 21 0 22 0;
#X connect 22 0 27 0;
#X connect 23 0 27 1;
#X connect 24 0 26 0;
#X connect 24 1 21 0;
#X connect 24 2 25 0;
#X connect 24 3 27 1;
#X connect 25 0 22 0;
#X connect 26 0 40 0;
#X connect 27 0 23 0;
#X connect 27 0 26 1;
#X connect 29 0 30 0;
#X connect 29 0 33 0;
#X connect 29 1 30 1;
#X connect 29 1 31 0;
#X connect 30 0 32 0;
#X connect 34 0 29 0;
#X connect 35 0 34 0;
#X connect 36 0 20 0;
#X connect 37 0 28 0;
#X restore 58 103 pd analysis;
#N canvas 439 88 431 287 init 0;
#X obj 72 41 loadbang;
#X msg 72 215 \; pd dsp 1 \;;
#X obj 72 63 t b b b b;
#X obj 152 103 s lb1;
#X obj 132 133 s lb2;
#X obj 102 163 s lb3;
#X obj 202 184 declare -path ../lib;
#X obj 236 52 r lb1;
#X msg 236 74 \; zc-thresh-set 250 \; filter-set 1 \; master-volume-set
90 \;;
#X connect 0 0 2 0;
#X connect 2 0 1 0;
#X connect 2 1 5 0;
#X connect 2 2 4 0;
#X connect 2 3 3 0;
#X connect 7 0 8 0;
#X restore 58 63 pd init;
#N canvas 0 22 450 278 (subpatch) 0;
#X array crossing-preview 50 float 0;
#X coords 0 1424 49 0 200 140 1 0 0;
#X restore 58 373 graph;
#N canvas 0 22 624 603 playback-controls 0;
#X obj 249 399 *;
#X obj 249 467 tabplay~ audio-file;
#X obj 249 543 *~;
#X obj 298 362 r hop;
#X obj 249 433 pack f f;
#X obj 327 185 f;
#X msg 385 120 0;
#X obj 384 173 + 1;
#X obj 327 269 t f f;
#X obj 386 325 tabread crossing-graph;
#X obj 391 80 / 44.1;
#X obj 391 55 r hop;
#X floatatom 169 131 5 0 0 1 ZC-thresh zc-thresh-set -, f 5;
#X obj 386 502 line~;
#X obj 386 480 pack f 20;
#N canvas 253 54 520 548 graph-preview 0;
#X obj 85 38 inlet;
#X obj 95 455 tabletool crossing-preview;
#X obj 311 312 r crossings-num-frames;
#X obj 261 312 moses;
#X obj 222 280 moses 0;
#X obj 95 402 pack f f;
#X obj 145 357 r crossings-num-frames;
#X obj 95 357 moses;
#X obj 56 325 moses 0;
#X msg 95 425 copy_range 0 crossing-graph \$1 \$2;
#X obj 85 60 t f f b;
#X msg 206 118 \; crossing-preview const 0 \;;
#X obj 222 246 + 50;
#X text 261 247 << size of crossing-preview array;
#X connect 0 0 10 0;
#X connect 2 0 3 1;
#X connect 3 0 5 1;
#X connect 4 1 3 0;
#X connect 5 0 9 0;
#X connect 6 0 7 1;
#X connect 7 0 5 0;
#X connect 8 1 7 0;
#X connect 9 0 1 0;
#X connect 10 0 8 0;
#X connect 10 1 12 0;
#X connect 10 2 11 0;
#X connect 12 0 4 0;
#X restore 355 236 pd graph-preview;
#X obj 386 406 route 0 1;
#X obj 109 151 tgl 15 0 empty filter-set filter 17 7 0 10 -262144 -1
-1 1 1;
#X obj 109 131 tgl 15 0 empty empty play 17 7 0 10 -262144 -1 -1 0
1;
#X obj 327 84 t f b;
#X obj 384 195 %;
#X obj 414 195 r crossings-num-frames;
#X obj 327 125 metro;
#X obj 109 171 volume~;
#X obj 386 442 <;
#X obj 454 441 >;
#X obj 386 358 list prepend;
#X msg 21 525 \; crossing-preview ylabel 0 \$1 \;;
#X connect 0 0 4 0;
#X connect 1 0 2 0;
#X connect 2 0 23 0;
#X connect 3 0 0 1;
#X connect 3 0 4 1;
#X connect 4 0 1 0;
#X connect 5 0 7 0;
#X connect 5 0 15 0;
#X connect 5 0 8 0;
#X connect 6 0 5 1;
#X connect 7 0 20 0;
#X connect 8 0 0 0;
#X connect 8 1 9 0;
#X connect 9 0 26 0;
#X connect 10 0 22 1;
#X connect 11 0 10 0;
#X connect 12 0 24 1;
#X connect 12 0 25 1;
#X connect 12 0 27 0;
#X connect 13 0 2 1;
#X connect 14 0 13 0;
#X connect 16 0 24 0;
#X connect 16 1 25 0;
#X connect 17 0 26 1;
#X connect 18 0 19 0;
#X connect 19 0 22 0;
#X connect 19 1 6 0;
#X connect 20 0 5 1;
#X connect 21 0 20 1;
#X connect 22 0 5 0;
#X connect 24 0 14 0;
#X connect 25 0 14 0;
#X connect 26 0 16 0;
#X coords 0 -1 1 1 220 120 1 100 100;
#X restore 58 223 pd playback-controls;
#X obj 3 4 cnv 10 400 10 empty empty empty 20 12 0 14 -233017 -66577
0;
#X obj 3 4 cnv 10 10 400 empty empty empty 20 12 0 14 -233017 -66577
0;
#X text 56 539 timbreID - William Brent 2017;
#N canvas 0 22 450 278 (subpatch) 0;
#X array crossing-graph 438 float 0;
#X coords 0 1424 438 0 400 140 1 0 0;
#X restore 298 373 graph;
#X text 316 257 Other audio features can be used to locate and classify
different consonants so that you can automate effects and other operations
based on speech phonemes.;
#X text 316 57 Here \, a short speech sample is analyzed frame by frame
for zero crossings \, which should be high during speech sounds like
"shh" "sss" "fff" "zzz" \, etc. The full results are shown in the crossing-graph
array. Take a look at the non-real-time analysis routine in [pd analysis]
to see how the analysis data was generated. Then try activating the
"play" toggle to hear the sound file played back with everything but
the high zero-crossing sections muted. You can also turn off the "filter"
toggle to hear the opposite: only the low zero-crossing sections will
be audible. Try adjusting the zero crossing threshold for playback
to something other than 250 if you like. The threshold point is labeled
in the scrolling preview graph as an aid for choosing a specific value.
;
